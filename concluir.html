<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Concluir Etapas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial, Helvetica, sans-serif;
  text-align:center;
}
.container{padding:20px}
.progress-bar{
  height:10px;
  background:#222;
  border-radius:5px;
  overflow:hidden;
  margin:20px 0;
}
#progress{
  height:100%;
  width:0%;
  background:lime;
  transition:width .4s;
}
button,a{
  display:block;
  margin:12px auto;
  padding:14px;
  border-radius:6px;
  text-decoration:none;
  font-weight:bold;
  width:100%;
  max-width:400px;
  border:none;
  cursor:pointer;
}
.visit{background:#007bff;color:#fff}
.confirm{background:#444;color:#fff;opacity:.6}
.confirm.active{background:green;opacity:1}
#download{display:none;background:green;color:#fff}
</style>
</head>

<body>
<div class="container">

<h1 id="titulo">Concluir tarefa</h1>

<div class="progress-bar">
  <div id="progress"></div>
</div>

<button class="visit" onclick="abrir()">Visitar página</button>
<button id="confirm" class="confirm" disabled onclick="finalizar()">✔ Já visitei</button>

<a id="download" target="_blank">Baixar Agora</a>

</div>

<script>
const params = new URLSearchParams(location.search);

titulo.textContent = params.get("titulo") || "Concluir tarefa";

const canalLink = params.get("canalLink");
const downloadLink = params.get("downloadLink");

const btnConfirm = document.getElementById("confirm");
const progress = document.getElementById("progress");
const download = document.getElementById("download");

let tempo = 0;
let timer = null;
const tempoMinimo = 10; // segundos

function abrir(){
  if(!canalLink){
    alert("Link inválido");
    return;
  }

  // abre link (mobile safe)
  location.href = canalLink;

  progress.style.width = "0%";
  tempo = 0;

  btnConfirm.disabled = true;
  btnConfirm.classList.remove("active");

  clearInterval(timer);
  timer = setInterval(()=>{
    tempo++;
    progress.style.width = (tempo/tempoMinimo*100)+"%";

    if(tempo >= tempoMinimo){
      clearInterval(timer);
      btnConfirm.disabled = false;
      btnConfirm.classList.add("active");
      progress.style.width = "100%";
    }
  },1000);
}

function finalizar(){
  if(!downloadLink){
    alert("Download não disponível");
    return;
  }

  download.href = downloadLink;
  download.style.display = "block";
}
</script>

</body>
</html>
